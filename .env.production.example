################################################################################
# JoinRuach.org - Production Environment Configuration
################################################################################
#
# CRITICAL: This file contains production configuration templates.
# - NEVER commit actual secrets to version control
# - Generate cryptographically random secrets for each environment
# - Use different secrets for dev/staging/production
# - Store production secrets in secure vault (1Password, AWS Secrets Manager, etc.)
#
# DEPLOYMENT CHECKLIST:
# [ ] All secrets generated with openssl rand -base64 48
# [ ] All HTTPS URLs use https:// not http://
# [ ] COOKIE_SECURE=true is set
# [ ] NODE_ENV=production on all servers
# [ ] Redis credentials configured (Upstash recommended)
# [ ] Stripe production keys (not test keys)
# [ ] CORS origins list verified
# [ ] Email service configured
# [ ] CDN URLs point to production CDN
#
################################################################################

# =============================================================================
# ENVIRONMENT
# =============================================================================

NODE_ENV=production

# =============================================================================
# NEXT.JS FRONTEND (apps/ruach-next)
# =============================================================================

# --- Core URLs ---
# CRITICAL: Must use HTTPS in production
NEXTAUTH_URL=https://joinruach.org
NEXT_PUBLIC_SITE_URL=https://joinruach.org

# --- NextAuth Secret ---
# CRITICAL: Must be 48+ characters, cryptographically random
# Generate: openssl rand -base64 48
# NEVER use the same secret across environments
# NEVER commit this secret to Git
NEXTAUTH_SECRET=__REPLACE_WITH_PRODUCTION_SECRET_FROM_openssl_rand_base64_48__

# --- Strapi Backend ---
# CRITICAL: Must use HTTPS in production
NEXT_PUBLIC_STRAPI_URL=https://api.joinruach.org

# --- Strapi API Tokens ---
# Generate in Strapi Admin Panel: Settings > API Tokens > Create New Token
# Token Type: Custom (select specific permissions)
# Duration: Unlimited or 90 days (regenerate before expiry)

# Main API token for public operations
STRAPI_API_TOKEN=__REPLACE_WITH_STRAPI_API_TOKEN__

# Collection-specific tokens (optional - falls back to STRAPI_API_TOKEN)
STRAPI_CONTACT_TOKEN=__REPLACE_WITH_CONTACT_TOKEN__
STRAPI_VOLUNTEER_TOKEN=__REPLACE_WITH_VOLUNTEER_TOKEN__
STRAPI_TESTIMONY_TOKEN=__REPLACE_WITH_TESTIMONY_TOKEN__

# Collection names (usually don't need to change)
STRAPI_CONTACT_COLLECTION=contact-submissions
STRAPI_VOLUNTEER_COLLECTION=volunteer-signups
STRAPI_TESTIMONY_COLLECTION=testimonies

# --- Strapi Revalidation Secret ---
# Generate: openssl rand -base64 32
# Must match REVALIDATE_SECRET in Strapi backend
STRAPI_REVALIDATE_SECRET=__REPLACE_WITH_REVALIDATE_SECRET__

# Email confirmation redirect URL
STRAPI_EMAIL_CONFIRM_REDIRECT=https://joinruach.org/confirmed

# --- Redis (Upstash) ---
# CRITICAL: Required for production rate limiting
# Get free account: https://upstash.com/
# Create Redis database, copy REST URL and Token
UPSTASH_REDIS_REST_URL=https://__YOUR_UPSTASH_INSTANCE__.upstash.io
UPSTASH_REDIS_REST_TOKEN=__REPLACE_WITH_UPSTASH_TOKEN__

# --- Stripe (Payment Processing) ---
# CRITICAL: Use PRODUCTION keys (sk_live_..., not sk_test_...)
# Get from: https://dashboard.stripe.com/apikeys
# IMPORTANT: Restrict API key permissions to minimum required
STRIPE_SECRET_KEY=sk_live___REPLACE_WITH_PRODUCTION_SECRET_KEY__
STRIPE_WEBHOOK_SECRET=whsec___REPLACE_WITH_WEBHOOK_SECRET__

# Stripe Price IDs (get from Stripe Dashboard > Products)
STRIPE_PRICE_ID=price___REPLACE_WITH_PRICE_ID__
STRIPE_PARTNER_PRICE_ID=price___REPLACE_WITH_PARTNER_PRICE_ID__

# Stripe Checkout URLs
STRIPE_CHECKOUT_SUCCESS_URL=https://joinruach.org/members/account?checkout=success
STRIPE_CHECKOUT_CANCEL_URL=https://joinruach.org/give?checkout=cancelled

# --- Analytics ---
# Plausible Analytics domain
NEXT_PUBLIC_PLAUSIBLE_DOMAIN=joinruach.org

# --- ConvertKit (Newsletter) ---
# Get API keys from: https://app.convertkit.com/account/edit
NEXT_PUBLIC_CONVERTKIT_FORM_ID=__REPLACE_WITH_FORM_ID__
NEXT_PUBLIC_CONVERTKIT_API_KEY=__REPLACE_WITH_API_KEY__
CONVERTKIT_API_SECRET=__REPLACE_WITH_API_SECRET__

# ConvertKit form configuration
NEXT_PUBLIC_CONVERTKIT_FORM_ACTION=https://app.convertkit.com/forms/__FORM_ID__/subscriptions
NEXT_PUBLIC_CONVERTKIT_FORM_METHOD=post
NEXT_PUBLIC_CONVERTKIT_FORM_TARGET=_blank

# Optional: Full embed HTML if using custom form
NEXT_PUBLIC_CONVERTKIT_EMBED_HTML=

# --- Giving / Donations (Givebutter) ---
NEXT_PUBLIC_GIVEBUTTER_URL=https://givebutter.com/__YOUR_CAMPAIGN__
NEXT_PUBLIC_GIVEBUTTER_GOAL_ID=__REPLACE_WITH_GOAL_ID__
NEXT_PUBLIC_GIVEBUTTER_REGISTRATION_URL=
NEXT_PUBLIC_GIVEBUTTER_EMBED_HTML=
NEXT_PUBLIC_MEMBERFUL_URL=
NEXT_PUBLIC_OUTREACH_GIVE_URL=https://joinruach.org/give

# --- Contact Email Addresses ---
NEXT_PUBLIC_CONTACT_STORIES_EMAIL=stories@joinruach.org
NEXT_PUBLIC_CONTACT_EVENTS_EMAIL=events@joinruach.org
NEXT_PUBLIC_CONTACT_PARTNERS_EMAIL=partners@joinruach.org
NEXT_PUBLIC_TESTIMONY_FORM_URL=https://joinruach.org/testimony

# --- Content Configuration ---
# Board members JSON (optional, for /about page)
NEXT_PUBLIC_BOARD_JSON=

# About page story image
NEXT_PUBLIC_ABOUT_STORY_IMAGE=https://cdn.joinruach.org/images/about-story.jpg

# --- Social Media Links ---
NEXT_PUBLIC_SOCIAL_INSTAGRAM=https://instagram.com/joinruach
NEXT_PUBLIC_SOCIAL_YOUTUBE=https://youtube.com/@joinruach
NEXT_PUBLIC_SOCIAL_FACEBOOK=https://facebook.com/joinruach
NEXT_PUBLIC_SOCIAL_SPOTIFY=https://open.spotify.com/show/__YOUR_SHOW__

# --- Moderation ---
# Comma-separated list of moderator email addresses
# These users can approve/reject comments
MODERATOR_EMAILS=admin@joinruach.org,moderator@joinruach.org

# =============================================================================
# STRAPI BACKEND (ruach-ministries-backend)
# =============================================================================

# --- Host Configuration ---
HOST=0.0.0.0
PORT=1337

# --- Application URLs ---
# CRITICAL: Must use HTTPS in production
APP_KEYS=__REPLACE_WITH_4_COMMA_SEPARATED_SECRETS__
API_TOKEN_SALT=__REPLACE_WITH_openssl_rand_base64_32__
ADMIN_JWT_SECRET=__REPLACE_WITH_openssl_rand_base64_32__
TRANSFER_TOKEN_SALT=__REPLACE_WITH_openssl_rand_base64_32__
JWT_SECRET=__REPLACE_WITH_openssl_rand_base64_32__

# --- Public URLs ---
STRAPI_PUBLIC_URL=https://api.joinruach.org
FRONTEND_URL=https://joinruach.org

# --- Email Confirmation ---
STRAPI_EMAIL_CONFIRM_REDIRECT=https://joinruach.org/confirmed

# --- Revalidation Secret ---
# Must match STRAPI_REVALIDATE_SECRET in Next.js
REVALIDATE_SECRET=__REPLACE_WITH_SAME_AS_NEXTJS__

# --- Database ---
# Production: Use PostgreSQL (not SQLite)
# Example PostgreSQL connection:
DATABASE_CLIENT=postgres
DATABASE_HOST=__YOUR_DB_HOST__
DATABASE_PORT=5432
DATABASE_NAME=joinruach_production
DATABASE_USERNAME=joinruach_user
DATABASE_PASSWORD=__REPLACE_WITH_DB_PASSWORD__
DATABASE_SSL=true

# --- Cookie Security ---
# CRITICAL: Must be 'true' in production
# Ensures refresh tokens only sent over HTTPS
COOKIE_SECURE=true

# --- CORS Configuration ---
# Comma-separated list of allowed origins (all must use https://)
# CRITICAL: No wildcards, no http:// URLs in production
CORS_ALLOWED_ORIGINS=https://joinruach.org,https://www.joinruach.org,https://cdn.joinruach.org

# --- Cloudflare R2 (Storage) ---
# Get credentials from Cloudflare Dashboard > R2
CLOUDFLARE_ACCOUNT_ID=__REPLACE_WITH_ACCOUNT_ID__
CLOUDFLARE_R2_ACCESS_KEY_ID=__REPLACE_WITH_ACCESS_KEY__
CLOUDFLARE_R2_SECRET_ACCESS_KEY=__REPLACE_WITH_SECRET_KEY__
CLOUDFLARE_R2_BUCKET_NAME=joinruach-media
CLOUDFLARE_R2_PUBLIC_URL=https://cdn.joinruach.org

# --- Email Service (SendGrid, Mailgun, etc.) ---
# Configure based on your email provider
EMAIL_PROVIDER=sendgrid
EMAIL_PROVIDER_API_KEY=__REPLACE_WITH_EMAIL_API_KEY__
EMAIL_DEFAULT_FROM=noreply@joinruach.org
EMAIL_DEFAULT_REPLY_TO=hello@joinruach.org

# --- Stripe Configuration (Backend) ---
# Same as frontend, but backend needs these too
STRIPE_SECRET_KEY=sk_live___REPLACE_WITH_PRODUCTION_SECRET_KEY__
STRIPE_WEBHOOK_SECRET=whsec___REPLACE_WITH_WEBHOOK_SECRET__

# Stripe role configuration
STRIPE_ACTIVE_ROLE_NAME=Partner
STRIPE_FALLBACK_ROLE_NAME=Authenticated

# --- Redis (Optional - for token persistence) ---
# Recommended for production, especially multi-instance deployments
# REDIS_URL=redis://:__PASSWORD__@__HOST__:6379
# Or use Upstash (same as frontend):
# REDIS_URL=__UPSTASH_REDIS_URL__

# =============================================================================
# VALIDATION CHECKLIST
# =============================================================================
#
# Before deploying to production, verify:
#
# SECURITY:
# [ ] All secrets are 32+ characters and cryptographically random
# [ ] No test/development secrets used in production
# [ ] All secrets unique to production environment
# [ ] COOKIE_SECURE=true
# [ ] NODE_ENV=production
#
# URLS:
# [ ] All URLs use https:// (no http://)
# [ ] NEXTAUTH_URL matches production domain
# [ ] NEXT_PUBLIC_STRAPI_URL points to production API
# [ ] STRAPI_PUBLIC_URL matches actual public URL
# [ ] CORS_ALLOWED_ORIGINS contains only production domains
#
# SERVICES:
# [ ] Stripe uses production keys (sk_live_, not sk_test_)
# [ ] Redis credentials configured (UPSTASH_REDIS_REST_URL)
# [ ] Email service configured and tested
# [ ] CDN URLs point to production CDN
# [ ] Database is PostgreSQL (not SQLite)
# [ ] Database has SSL enabled
#
# MONITORING:
# [ ] Plausible Analytics configured
# [ ] Error tracking configured (Sentry, etc.)
# [ ] Log aggregation configured
# [ ] Uptime monitoring configured
#
# BACKUPS:
# [ ] Database backups scheduled (daily minimum)
# [ ] Redis persistence enabled (if using)
# [ ] Media storage backups configured
# [ ] Secrets stored in secure vault
#
# =============================================================================
# SECRETS GENERATION COMMANDS
# =============================================================================
#
# Generate secrets using these commands:
#
# NEXTAUTH_SECRET (48 characters):
#   openssl rand -base64 48
#
# STRAPI_REVALIDATE_SECRET (32 characters):
#   openssl rand -base64 32
#
# ADMIN_JWT_SECRET, API_TOKEN_SALT, JWT_SECRET (32 characters each):
#   openssl rand -base64 32
#
# APP_KEYS (4 secrets, comma-separated):
#   echo "$(openssl rand -base64 32),$(openssl rand -base64 32),$(openssl rand -base64 32),$(openssl rand -base64 32)"
#
# =============================================================================
