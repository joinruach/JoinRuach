---
phase: 11-edl-generation
plan: 01
type: execute
---

<objective>
Implement Canonical EDL (Edit Decision List) data model and JSON specification.

Purpose: Establish the source-of-truth format for multi-camera edit decisions, enabling deterministic AI/rules-based editing and operator review/approval workflows.

Output: Strapi content types for EDL storage and TypeScript interfaces for the canonical EDL JSON format.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/phases/09-media-ingestion-sync/09-SUMMARY.md
@.planning/phases/10-transcript-alignment/10-SUMMARY.md
@ruach-ministries-backend/src/api/recording-session/content-types/recording-session/schema.json
@ruach-ministries-backend/src/api/library-transcription/content-types/library-transcription/schema.json

**From Phase 9:**
- syncOffsets_ms - Camera time offsets (e.g., {A: 0, B: 1830, C: -420})
- anchorAngle - Master camera identifier
- Proxy and mezzanine URLs available for all cameras

**From Phase 10:**
- Aligned transcripts per camera stored in library-transcription.metadata.masterTranscript
- Speaker labels with word-level timestamps
- Confidence scores for quality assessment

**Phase 11 Goal:**
Given a session with synced multi-cam assets and aligned transcripts, produce a time-accurate edit plan:
- Camera switches (A/B/C)
- Chapters
- Lower-thirds/overlays (optional)
- B-roll placeholders (optional)
- Exportable to NLE formats or directly to Remotion (Phase 12)

**Non-negotiables:**
- Every cut time is in session master timebase (ms) and maps to each camera via offsets
- Deterministic replay: same inputs + same settings = same EDL JSON
- Operator can review and lock the EDL before rendering
- Canonical EDL JSON is the single source of truth
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create edit-decision-list Strapi content type</name>
  <files>ruach-ministries-backend/src/api/edit-decision-list/content-types/edit-decision-list/schema.json</files>
  <action>Create Strapi content type for storing Edit Decision Lists:

  Collection: edit-decision-list

  Fields:
  - edlId (uid, required, unique) - Unique EDL identifier
  - session (relation, oneToOne, recording-session) - Link to recording session
  - version (integer, default: 1) - EDL version number
  - status (enum: ["draft", "reviewing", "approved", "locked"], default: "draft") - Workflow status
  - source (enum: ["ai", "operator", "hybrid"], default: "ai") - How EDL was generated
  - timebase (string, default: "ms") - Time unit (milliseconds)
  - fps (integer, optional) - Frames per second if needed
  - canonicalEdl (json, required) - The canonical EDL JSON (source of truth)
  - exports (json, default: {}) - Generated export URLs/metadata (fcpxml, premiere, resolve, json)
  - audit (json, default: {}) - Generation metadata (prompt, model, temperature, hashes)
  - metadata (json, default: {}) - Additional metadata

  Use Strapi CLI to generate the content type:
  cd ruach-ministries-backend && npx strapi generate content-type

  Or manually create the schema.json file following Strapi v5 content type structure.

  Ensure the schema follows the same pattern as recording-session and library-transcription.</action>
  <verify>Schema file exists, TypeScript compiles, content type appears in Strapi admin</verify>
  <done>edit-decision-list content type created and ready to store EDL data</done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript canonical EDL interfaces</name>
  <files>ruach-ministries-backend/src/types/canonical-edl.ts</files>
  <action>Define TypeScript interfaces for Canonical EDL v1.0:

  Create comprehensive type definitions:

  ```typescript
  export interface CanonicalEDL {
    schemaVersion: "1.0";
    sessionId: string;
    masterCamera: "A" | "B" | "C";
    durationMs: number;
    fps?: number;

    tracks: {
      program: Cut[];
      overlays?: Overlay[];
      chapters?: Chapter[];
      shorts?: ShortRecipe[];
    };

    sources: Record<string, CameraSource>;

    metrics?: EDLMetrics;
  }

  export interface Cut {
    id: string;
    startMs: number;
    endMs: number;
    camera: "A" | "B" | "C";
    reason?: "speaker" | "reaction" | "wide" | "emphasis" | "operator";
    confidence?: number; // 0-1
  }

  export interface CameraSource {
    assetId: string;
    proxyUrl?: string;
    mezzanineUrl?: string;
    offsetMs: number; // relative to master timeline
  }

  export interface Overlay {
    id: string;
    startMs: number;
    endMs: number;
    type: "lowerThird" | "title" | "scripture" | "cta";
    payload: Record<string, any>;
  }

  export interface Chapter {
    startMs: number;
    title: string;
  }

  export interface ShortRecipe {
    startMs: number;
    endMs: number;
    title: string;
    hook?: string;
  }

  export interface EDLMetrics {
    cutCount: number;
    avgShotLenMs: number;
    speakerSwitchCount?: number;
    confidence?: number;
  }
  ```

  Include JSDoc comments explaining each field.
  Export all types for use in services and controllers.</action>
  <verify>TypeScript compiles, interfaces export correctly, no linting errors</verify>
  <done>Canonical EDL type definitions available for all Phase 11 code</done>
</task>

<task type="auto">
  <name>Task 3: Link EDL to recording-session schema</name>
  <files>ruach-ministries-backend/src/api/recording-session/content-types/recording-session/schema.json</files>
  <action>Add EDL relation to recording-session schema:

  Add new field to recording-session attributes:
  ```json
  "edl": {
    "type": "relation",
    "relation": "oneToOne",
    "target": "api::edit-decision-list.edit-decision-list"
  }
  ```

  This creates a bidirectional relation:
  - recording-session.edl → edit-decision-list
  - edit-decision-list.session → recording-session

  This follows the same pattern as:
  - recording-session.transcript → library-transcription (Phase 10)
  - recording-session.summary → media-summary

  Keep the relation optional (no required: true) since EDLs are generated after transcription.</action>
  <verify>Schema valid JSON, TypeScript compiles, relation appears in Strapi admin</verify>
  <done>Recording session can link to its EDL, enabling populate queries</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] edit-decision-list content type exists in Strapi
- [ ] canonical-edl.ts exports all type interfaces
- [ ] recording-session schema has edl relation
- [ ] pnpm run build succeeds
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- EDL content type can store canonical EDL JSON
- TypeScript interfaces match JSON spec exactly
- Recording session can link to EDL via relation
- Ready for Phase 11 Plan 2 (EDL Generator Engine)
</success_criteria>

<output>
After completion, create `.planning/phases/11-edl-generation/11-01-SUMMARY.md`:

# Phase 11 Plan 1: EDL Data Model & Schema Summary

**Canonical EDL foundation established**

## Accomplishments

- Created edit-decision-list Strapi content type for EDL storage
- Defined Canonical EDL v1.0 TypeScript interfaces
- Linked EDL to recording-session via oneToOne relation
- Established workflow status (draft → reviewing → approved → locked)

## Files Created/Modified

- `ruach-ministries-backend/src/api/edit-decision-list/content-types/edit-decision-list/schema.json` - EDL content type
- `ruach-ministries-backend/src/types/canonical-edl.ts` - Type definitions
- `ruach-ministries-backend/src/api/recording-session/content-types/recording-session/schema.json` - Added edl relation

## Decisions Made

- Canonical EDL JSON is the single source of truth
- All times in master timebase (milliseconds)
- Camera offsets stored in sources for mapping
- Status workflow: draft → reviewing → approved → locked
- Exports field stores generated NLE format URLs
- Audit field tracks generation parameters for determinism

## Next Step

Ready for 11-02-PLAN.md: EDL Generator Engine (rules-based camera switching + AI chapter generation)
</output>
